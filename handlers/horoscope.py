"""
Love Horoscope feature
"""
import random
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup, LabeledPrice
from telegram.ext import ContextTypes, CallbackQueryHandler

import database as db
from config import HOROSCOPE_PRICE, ZODIAC_SIGNS

# Horoscope templates per sign
HOROSCOPE_TEMPLATES = {
    "‚ôà": [
        "–°–µ–≥–æ–¥–Ω—è –∑–≤—ë–∑–¥—ã –±–ª–∞–≥–æ–≤–æ–ª—è—Ç —Ä–æ–º–∞–Ω—Ç–∏–∫–µ! –ù–µ –±–æ–π—Å—è —Å–¥–µ–ª–∞—Ç—å –ø–µ—Ä–≤—ã–π —à–∞–≥. üî•",
        "–ú–∞—Ä—Å –¥–∞—Ä–∏—Ç —Ç–µ–±–µ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å ‚Äî –ø—Ä–∏–∑–Ω–∞–π—Å—è –≤ —á—É–≤—Å—Ç–≤–∞—Ö! üí™",
        "–î–µ–Ω—å –ø–æ–ª–æ–Ω —ç–Ω–µ—Ä–≥–∏–∏ ‚Äî –æ—Ç–ø—Ä–∞–≤—å –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫—É —Å–º–µ–ª–æ–º—É —á–µ–ª–æ–≤–µ–∫—É! ‚ù§Ô∏è",
    ],
    "‚ôâ": [
        "–í–µ–Ω–µ—Ä–∞ –Ω–∞ —Ç–≤–æ–µ–π —Å—Ç–æ—Ä–æ–Ω–µ! –£—Å—Ç—Ä–æ–π —Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –≤–µ—á–µ—Ä. üåπ",
        "–°–µ–≥–æ–¥–Ω—è –∏–¥–µ–∞–ª—å–Ω—ã–π –¥–µ–Ω—å –¥–ª—è –ø–æ–¥–∞—Ä–∫–æ–≤ –∏ –≤–∫—É—Å–Ω–æ–π –µ–¥—ã –≤–¥–≤–æ—ë–º. üç´",
        "–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å ‚Äî —Ç–≤–æ–π –∫–æ–∑—ã—Ä—å. –ü–æ–∫–∞–∂–∏, –∫–∞–∫ —Ç—ã –∑–∞–±–æ—Ç–∏—à—å—Å—è! üíé",
    ],
    "‚ôä": [
        "–û–±—â–µ–Ω–∏–µ ‚Äî —Ç–≤–æ—è —Å—É–ø–µ—Ä—Å–∏–ª–∞! –ù–∞–ø–∏—à–∏ —è—Ä–∫–æ–µ –ø–æ—Å–ª–∞–Ω–∏–µ. ‚ú®",
        "–°–µ–≥–æ–¥–Ω—è —Å–ª–æ–≤–∞ –æ—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–Ω—ã. –£–¥–∏–≤–∏ —Å–≤–æ–∏–º–∏ —á—É–≤—Å—Ç–≤–∞–º–∏! üí¨",
        "–ë–ª–∏–∑–Ω–µ—Ü—ã –≤ —É–¥–∞—Ä–µ ‚Äî –æ—Ç–ø—Ä–∞–≤—å —Å—Ä–∞–∑—É –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞–ª–µ–Ω—Ç–∏–Ω–æ–∫! üíå",
    ],
    "‚ôã": [
        "–õ—É–Ω–∞ —É—Å–∏–ª–∏–≤–∞–µ—Ç —ç–º–æ—Ü–∏–∏ ‚Äî –¥–∞–π –≤–æ–ª—é —á—É–≤—Å—Ç–≤–∞–º! üåô",
        "–¢–≤–æ—è –Ω–µ–∂–Ω–æ—Å—Ç—å —Ä–∞—Å—Ç–æ–ø–∏—Ç –ª—é–±–æ–µ —Å–µ—Ä–¥—Ü–µ —Å–µ–≥–æ–¥–Ω—è. ü•∞",
        "–î–æ–º –∏ —É—é—Ç ‚Äî —Ç–≤–æ—è —Å—Ç–∏—Ö–∏—è. –°–æ–∑–¥–∞–π —Ç—ë–ø–ª—É—é –∞—Ç–º–æ—Å—Ñ–µ—Ä—É! üè†",
    ],
    "‚ôå": [
        "–°–æ–ª–Ω—Ü–µ —Å–∏—è–µ—Ç –¥–ª—è —Ç–µ–±—è! –ë—É–¥—å –≤ —Ü–µ–Ω—Ç—Ä–µ –≤–Ω–∏–º–∞–Ω–∏—è. üëë",
        "–°–µ–≥–æ–¥–Ω—è —Ç—ã –Ω–µ–æ—Ç—Ä–∞–∑–∏–º(–∞) ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π —ç—Ç–æ! ü¶Å",
        "–õ–µ–≤ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —â–µ–¥—Ä—ã–º ‚Äî —É–¥–∏–≤–∏ –≥—Ä–∞–Ω–¥–∏–æ–∑–Ω—ã–º –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ–º! üéÅ",
    ],
    "‚ôç": [
        "–î–µ—Ç–∞–ª–∏ —Ä–µ—à–∞—é—Ç –≤—Å—ë ‚Äî –Ω–∞–ø–∏—à–∏ –ø—Ä–æ–¥—É–º–∞–Ω–Ω—É—é –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫—É. üìù",
        "–¢–≤–æ—è –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–∫–æ—Ä–∏—Ç —Å–µ—Ä–¥—Ü–∞! üåü",
        "–ó–∞–±—É–¥—å –ø–µ—Ä—Ñ–µ–∫—Ü–∏–æ–Ω–∏–∑–º ‚Äî –ø—Ä–æ—Å—Ç–æ —Å–∫–∞–∂–∏, —á—Ç–æ —á—É–≤—Å—Ç–≤—É–µ—à—å! üíï",
    ],
    "‚ôé": [
        "–ì–∞—Ä–º–æ–Ω–∏—è –∏ –∫—Ä–∞—Å–æ—Ç–∞ ‚Äî —Ç–≤–æ–∏ —Å–æ—é–∑–Ω–∏–∫–∏. –°–æ–∑–¥–∞–π —à–µ–¥–µ–≤—Ä! ‚öñÔ∏è",
        "–í–µ—Å—ã –ø—Ä–∏—Ç—è–≥–∏–≤–∞—é—Ç –ª—é–±–æ–≤—å ‚Äî –±—É–¥—å –æ—Ç–∫—Ä—ã—Ç(–∞) –Ω–æ–≤–æ–º—É! üíò",
        "–ò–¥–µ–∞–ª—å–Ω—ã–π –¥–µ–Ω—å –¥–ª—è —Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏—Ö –ø–ª–∞–Ω–æ–≤! üå∫",
    ],
    "‚ôè": [
        "–°—Ç—Ä–∞—Å—Ç—å –∑–∞—à–∫–∞–ª–∏–≤–∞–µ—Ç! –ü–æ–∫–∞–∂–∏ –≥–ª—É–±–∏–Ω—É —á—É–≤—Å—Ç–≤. ü¶Ç",
        "–¢–∞–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å ‚Äî —Ç–≤–æ–µ –æ—Ä—É–∂–∏–µ. –û—Ç–ø—Ä–∞–≤—å –∞–Ω–æ–Ω–∏–º–∫—É! üîÆ",
        "–°–∫–æ—Ä–ø–∏–æ–Ω –≤ –¥–µ–ª–µ ‚Äî –Ω–∏–∫—Ç–æ –Ω–µ —É—Å—Ç–æ–∏—Ç! üí•",
    ],
    "‚ôê": [
        "–Æ–ø–∏—Ç–µ—Ä –ø—Ä–∏–Ω–æ—Å–∏—Ç —É–¥–∞—á—É –≤ –ª—é–±–≤–∏! –†–∏—Å–∫–Ω–∏! üèπ",
        "–ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è –∂–¥—É—Ç ‚Äî –ø—Ä–µ–¥–ª–æ–∂–∏ –Ω–µ–æ–±—ã—á–Ω–æ–µ —Å–≤–∏–¥–∞–Ω–∏–µ! üåç",
        "–û–ø—Ç–∏–º–∏–∑–º –∑–∞—Ä–∞–∑–∏—Ç–µ–ª–µ–Ω ‚Äî –∑–∞—Ä—è–¥–∏—Å—å –∏ –∑–∞—Ä—è–∂–∞–π –¥—Ä—É–≥–∏—Ö! üéØ",
    ],
    "‚ôë": [
        "–°–µ—Ä—å—ë–∑–Ω—ã–µ –Ω–∞–º–µ—Ä–µ–Ω–∏—è —É–º–µ—Å—Ç–Ω—ã —Å–µ–≥–æ–¥–Ω—è. üèîÔ∏è",
        "–ö–æ–∑–µ—Ä–æ–≥ –∑–Ω–∞–µ—Ç —Ü–µ–Ω—É —á—É–≤—Å—Ç–≤–∞–º ‚Äî –ø–æ–∫–∞–∂–∏ —ç—Ç–æ! üíò",
        "–¢–µ—Ä–ø–µ–Ω–∏–µ –≤–æ–∑–Ω–∞–≥—Ä–∞–¥–∏—Ç—Å—è ‚Äî –¥–µ–π—Å—Ç–≤—É–π —É–≤–µ—Ä–µ–Ω–Ω–æ! ‚≠ê",
    ],
    "‚ôí": [
        "–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å ‚Äî –∫–ª—é—á –∫ —Å–µ—Ä–¥—Ü—É! –£–¥–∏–≤–∏ –Ω–µ–æ–±—ã—á–Ω–æ! üåä",
        "–í–æ–¥–æ–ª–µ–π –ø–æ–ª–æ–Ω –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã—Ö –∏–¥–µ–π –¥–ª—è –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫–∏! üí°",
        "–ë—É–¥—å —Å–æ–±–æ–π ‚Äî —ç—Ç–æ —Ç–æ, —á—Ç–æ –ª—é–±—è—Ç –≤ —Ç–µ–±–µ! ü¶Ñ",
    ],
    "‚ôì": [
        "–†–æ–º–∞–Ω—Ç–∏–∫–∞ –≤–∏—Ç–∞–µ—Ç –≤ –≤–æ–∑–¥—É—Ö–µ ‚Äî –ø–æ–π–º–∞–π –≤–æ–ª–Ω—É! üêü",
        "–†—ã–±—ã —á—É–≤—Å—Ç–≤—É—é—Ç –ª—é–±–æ–≤—å –≥–ª—É–±–∂–µ –≤—Å–µ—Ö. –ü–æ–¥–µ–ª–∏—Å—å —ç—Ç–∏–º! üåä",
        "–ú–µ—á—Ç–∞–π –∏ –¥–µ–π—Å—Ç–≤—É–π ‚Äî —Å–µ–≥–æ–¥–Ω—è –º–µ—á—Ç—ã —Å–±—ã–≤–∞—é—Ç—Å—è! üí≠",
    ],
}

DETAILED_HOROSCOPE = {
    "‚ôà": "üî• **–û–≤–µ–Ω –∏ –ª—é–±–æ–≤—å –≤ –î–µ–Ω—å –í–∞–ª–µ–Ω—Ç–∏–Ω–∞**\n\n–ú–∞—Ä—Å –Ω–∞–ø–æ–ª–Ω—è–µ—Ç —Ç–µ–±—è —Å—Ç—Ä–∞—Å—Ç—å—é! –°–µ–≥–æ–¥–Ω—è —Ç–≤–æ—è —ç–Ω–µ—Ä–≥–∏—è –Ω–∞ –º–∞–∫—Å–∏–º—É–º–µ. –õ—É—á—à–µ–µ –≤—Ä–µ–º—è –¥–ª—è —Å–º–µ–ª—ã—Ö –ø—Ä–∏–∑–Ω–∞–Ω–∏–π ‚Äî –Ω–µ –∂–¥–∏, –¥–µ–π—Å—Ç–≤—É–π –ø–µ—Ä–≤—ã–º(–æ–π)! –í –ø–∞—Ä–µ –æ–∂–∏–¥–∞–π –ø—Ä–∏—è—Ç–Ω—ã—Ö —Å—é—Ä–ø—Ä–∏–∑–æ–≤. –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: ‚ôå –õ–µ–≤, ‚ôê –°—Ç—Ä–µ–ª–µ—Ü, ‚ôä –ë–ª–∏–∑–Ω–µ—Ü—ã.",
    "‚ôâ": "üåπ **–¢–µ–ª–µ—Ü –∏ –ª—é–±–æ–≤—å –≤ –î–µ–Ω—å –í–∞–ª–µ–Ω—Ç–∏–Ω–∞**\n\n–í–µ–Ω–µ—Ä–∞, —Ç–≤–æ—è –ø–æ–∫—Ä–æ–≤–∏—Ç–µ–ª—å–Ω–∏—Ü–∞, —Å–µ–≥–æ–¥–Ω—è –≤ –ø–æ–ª–Ω–æ–π —Å–∏–ª–µ! –û—Ä–≥–∞–Ω–∏–∑—É–π —Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π —É–∂–∏–Ω –∏–ª–∏ –ø–æ–¥–∞—Ä–∏ —á—Ç–æ-—Ç–æ –æ—Å—è–∑–∞–µ–º–æ–µ. –¢–∞–∫—Ç–∏–ª—å–Ω–æ—Å—Ç—å ‚Äî –∫–ª—é—á! –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: ‚ôã –†–∞–∫, ‚ôç –î–µ–≤–∞, ‚ôì –†—ã–±—ã.",
    "‚ôä": "‚ú® **–ë–ª–∏–∑–Ω–µ—Ü—ã –∏ –ª—é–±–æ–≤—å –≤ –î–µ–Ω—å –í–∞–ª–µ–Ω—Ç–∏–Ω–∞**\n\n–¢–≤–æ—ë –∫—Ä–∞—Å–Ω–æ—Ä–µ—á–∏–µ —Å–µ–≥–æ–¥–Ω—è ‚Äî –º–æ—â–Ω–µ–π—à–µ–µ –æ—Ä—É–∂–∏–µ! –ü–∏—à–∏ —Å—Ç–∏—Ö–∏, –æ—Å—Ç–∞–≤–ª—è–π –∑–∞–ø–∏—Å–∫–∏, –±–æ–ª—Ç–∞–π –¥–æ —É—Ç—Ä–∞. –ì–ª–∞–≤–Ω–æ–µ ‚Äî –æ–±—â–µ–Ω–∏–µ! –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: ‚ôé –í–µ—Å—ã, ‚ôí –í–æ–¥–æ–ª–µ–π, ‚ôà –û–≤–µ–Ω.",
    "‚ôã": "üåô **–†–∞–∫ –∏ –ª—é–±–æ–≤—å –≤ –î–µ–Ω—å –í–∞–ª–µ–Ω—Ç–∏–Ω–∞**\n\n–õ—É–Ω–∞ —É—Å–∏–ª–∏–≤–∞–µ—Ç –∏–Ω—Ç—É–∏—Ü–∏—é ‚Äî —Ç—ã —Ç–æ—á–Ω–æ –∑–Ω–∞–µ—à—å, —á—Ç–æ –Ω—É–∂–Ω–æ –ª—é–±–∏–º–æ–º—É —á–µ–ª–æ–≤–µ–∫—É. –°–æ–∑–¥–∞–π —É—é—Ç –∏ —Ç–µ–ø–ª–æ. –î–æ–º–∞—à–Ω–∏–π –≤–µ—á–µ—Ä ‚Äî –ª—É—á—à–∏–π –ø–æ–¥–∞—Ä–æ–∫! –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: ‚ôâ –¢–µ–ª–µ—Ü, ‚ôè –°–∫–æ—Ä–ø–∏–æ–Ω, ‚ôç –î–µ–≤–∞.",
    "‚ôå": "üëë **–õ–µ–≤ –∏ –ª—é–±–æ–≤—å –≤ –î–µ–Ω—å –í–∞–ª–µ–Ω—Ç–∏–Ω–∞**\n\n–°–æ–ª–Ω—Ü–µ –¥–∞—Ä–∏—Ç —Ç–µ–±–µ –Ω–µ–æ—Ç—Ä–∞–∑–∏–º–æ–µ –æ–±–∞—è–Ω–∏–µ! –ë—É–¥—å —â–µ–¥—Ä—ã–º(–æ–π) ‚Äî —É—Å—Ç—Ä–æ–π –≥—Ä–∞–Ω–¥–∏–æ–∑–Ω—ã–π –ø—Ä–∞–∑–¥–Ω–∏–∫! –¢—ã –∑–∞—Å–ª—É–∂–∏–≤–∞–µ—à—å –∫–æ—Ä–æ–ª–µ–≤—Å–∫–æ–≥–æ –æ–±—Ä–∞—â–µ–Ω–∏—è! –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: ‚ôà –û–≤–µ–Ω, ‚ôê –°—Ç—Ä–µ–ª–µ—Ü, ‚ôä –ë–ª–∏–∑–Ω–µ—Ü—ã.",
    "‚ôç": "üìù **–î–µ–≤–∞ –∏ –ª—é–±–æ–≤—å –≤ –î–µ–Ω—å –í–∞–ª–µ–Ω—Ç–∏–Ω–∞**\n\n–î–µ—Ç–∞–ª–∏ –∏ –∑–∞–±–æ—Ç–∞ ‚Äî —Ç–≤–æ—è —Å—É–ø–µ—Ä—Å–∏–ª–∞! –ü—Ä–æ–¥—É–º–∞–π –∫–∞–∂–¥—É—é –º–µ–ª–æ—á—å –ø—Ä–∞–∑–¥–Ω–∏–∫–∞. –¢–≤–æ—è –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä–∞—Å—Ç–æ–ø–∏—Ç —Å–µ—Ä–¥—Ü–µ. –ù–µ –∑–∞–±—É–¥—å —Ä–∞—Å—Å–ª–∞–±–∏—Ç—å—Å—è! –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: ‚ôâ –¢–µ–ª–µ—Ü, ‚ôã –†–∞–∫, ‚ôë –ö–æ–∑–µ—Ä–æ–≥.",
    "‚ôé": "‚öñÔ∏è **–í–µ—Å—ã –∏ –ª—é–±–æ–≤—å –≤ –î–µ–Ω—å –í–∞–ª–µ–Ω—Ç–∏–Ω–∞**\n\n–ì–∞—Ä–º–æ–Ω–∏—è –∏ –∫—Ä–∞—Å–æ—Ç–∞ ‚Äî –≤—Å—ë, —á—Ç–æ –Ω—É–∂–Ω–æ! –≠—Å—Ç–µ—Ç–∏—á–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫, –∫—Ä–∞—Å–∏–≤–æ–µ –º–µ—Å—Ç–æ, –∏–¥–µ–∞–ª—å–Ω–∞—è –∞—Ç–º–æ—Å—Ñ–µ—Ä–∞. –¢—ã –º–∞—Å—Ç–µ—Ä —Ä–æ–º–∞–Ω—Ç–∏–∫–∏! –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: ‚ôä –ë–ª–∏–∑–Ω–µ—Ü—ã, ‚ôí –í–æ–¥–æ–ª–µ–π, ‚ôå –õ–µ–≤.",
    "‚ôè": "ü¶Ç **–°–∫–æ—Ä–ø–∏–æ–Ω –∏ –ª—é–±–æ–≤—å –≤ –î–µ–Ω—å –í–∞–ª–µ–Ω—Ç–∏–Ω–∞**\n\n–ì–ª—É–±–∏–Ω–∞ —Ç–≤–æ–∏—Ö —á—É–≤—Å—Ç–≤ –ø–æ—Ä–∞–∂–∞–µ—Ç! –¢–∞–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å ‚Äî —Ç–≤–æ–π –∫–æ–∑—ã—Ä—å. –ê–Ω–æ–Ω–∏–º–Ω–∞—è –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫–∞ ‚Äî –∏–¥–µ–∞–ª—å–Ω–æ –¥–ª—è —Ç–µ–±—è! –ü–æ–∫–∞–∂–∏ —Å—Ç—Ä–∞—Å—Ç—å! –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: ‚ôã –†–∞–∫, ‚ôì –†—ã–±—ã, ‚ôç –î–µ–≤–∞.",
    "‚ôê": "üèπ **–°—Ç—Ä–µ–ª–µ—Ü –∏ –ª—é–±–æ–≤—å –≤ –î–µ–Ω—å –í–∞–ª–µ–Ω—Ç–∏–Ω–∞**\n\n–Æ–ø–∏—Ç–µ—Ä –Ω–µ—Å—ë—Ç —É–¥–∞—á—É! –ü—Ä–µ–¥–ª–æ–∂–∏ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ ‚Äî –Ω–µ–æ–±—ã—á–Ω–æ–µ —Å–≤–∏–¥–∞–Ω–∏–µ, —Å–ø–æ–Ω—Ç–∞–Ω–Ω—É—é –ø–æ–µ–∑–¥–∫—É. –û–ø—Ç–∏–º–∏–∑–º –∑–∞—Ä–∞–∂–∞–µ—Ç! –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: ‚ôà –û–≤–µ–Ω, ‚ôå –õ–µ–≤, ‚ôé –í–µ—Å—ã.",
    "‚ôë": "üèîÔ∏è **–ö–æ–∑–µ—Ä–æ–≥ –∏ –ª—é–±–æ–≤—å –≤ –î–µ–Ω—å –í–∞–ª–µ–Ω—Ç–∏–Ω–∞**\n\n–°–∞—Ç—É—Ä–Ω –≥–æ–≤–æ—Ä–∏—Ç: —Å–µ—Ä—å—ë–∑–Ω—ã–µ –Ω–∞–º–µ—Ä–µ–Ω–∏—è ‚Äî —ç—Ç–æ –Ω–µ —Å–∫—É—á–Ω–æ! –ü–æ–∫–∞–∂–∏ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å. –ü–æ–¥–∞—Ä–æ–∫ —Å–æ —Å–º—ã—Å–ª–æ–º ‚Äî –ª—É—á—à–∏–π –≤—ã–±–æ—Ä! –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: ‚ôâ –¢–µ–ª–µ—Ü, ‚ôç –î–µ–≤–∞, ‚ôè –°–∫–æ—Ä–ø–∏–æ–Ω.",
    "‚ôí": "üåä **–í–æ–¥–æ–ª–µ–π –∏ –ª—é–±–æ–≤—å –≤ –î–µ–Ω—å –í–∞–ª–µ–Ω—Ç–∏–Ω–∞**\n\n–£—Ä–∞–Ω –≤–¥–æ—Ö–Ω–æ–≤–ª—è–µ—Ç –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å! –ó–∞–±—É–¥—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã ‚Äî —É–¥–∏–≤–∏ –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–º –ø–æ–¥—Ö–æ–¥–æ–º! –ù–µ–æ–±—ã—á–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫ –∑–∞–ø–æ–º–Ω–∏—Ç—Å—è –Ω–∞–≤—Å–µ–≥–¥–∞! –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: ‚ôä –ë–ª–∏–∑–Ω–µ—Ü—ã, ‚ôé –í–µ—Å—ã, ‚ôê –°—Ç—Ä–µ–ª–µ—Ü.",
    "‚ôì": "üêü **–†—ã–±—ã –∏ –ª—é–±–æ–≤—å –≤ –î–µ–Ω—å –í–∞–ª–µ–Ω—Ç–∏–Ω–∞**\n\n–ù–µ–ø—Ç—É–Ω —É—Å–∏–ª–∏–≤–∞–µ—Ç —Ä–æ–º–∞–Ω—Ç–∏–∫—É! –¢—ã —á—É–≤—Å—Ç–≤—É–µ—à—å –ª—é–±–æ–≤—å –≥–ª—É–±–∂–µ –≤—Å–µ—Ö. –°—Ç–∏—Ö–∏, –º—É–∑—ã–∫–∞, –∏—Å–∫—É—Å—Å—Ç–≤–æ ‚Äî –≤—ã—Ä–∞–∑–∏ —á—É–≤—Å—Ç–≤–∞ —á–µ—Ä–µ–∑ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ! –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: ‚ôã –†–∞–∫, ‚ôè –°–∫–æ—Ä–ø–∏–æ–Ω, ‚ôâ –¢–µ–ª–µ—Ü.",
}


async def choose_zodiac(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Show zodiac sign picker"""
    query = update.callback_query
    await query.answer()

    # Build zodiac keyboard (4 signs per row)
    signs = list(ZODIAC_SIGNS.items())
    keyboard = []
    for i in range(0, len(signs), 4):
        row = [
            InlineKeyboardButton(f"{emoji} {name}", callback_data=f"zodiac_{emoji}")
            for emoji, name in signs[i:i+4]
        ]
        keyboard.append(row)
    keyboard.append([InlineKeyboardButton("‚óÄÔ∏è –ù–∞–∑–∞–¥", callback_data="menu_main")])

    await query.edit_message_text(
        "üîÆ **–õ–Æ–ë–û–í–ù–´–ô –ì–û–†–û–°–ö–û–ü**\n\n"
        "–í—ã–±–µ—Ä–∏ —Å–≤–æ–π –∑–Ω–∞–∫ –∑–æ–¥–∏–∞–∫–∞:",
        reply_markup=InlineKeyboardMarkup(keyboard),
        parse_mode="Markdown"
    )


async def set_zodiac_and_show(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Set zodiac and show horoscope"""
    query = update.callback_query
    await query.answer()

    sign = query.data.replace("zodiac_", "")
    user = query.from_user

    # Save zodiac
    await db.set_zodiac(user.id, sign)

    # Show free horoscope
    sign_name = ZODIAC_SIGNS.get(sign, "")
    horoscope = random.choice(HOROSCOPE_TEMPLATES.get(sign, ["–ó–≤—ë–∑–¥—ã –≥–æ—Ç–æ–≤—è—Ç —Å—é—Ä–ø—Ä–∏–∑!"]))

    keyboard = [
        [InlineKeyboardButton(
            f"üîÆ –ü–æ–¥—Ä–æ–±–Ω—ã–π –≥–æ—Ä–æ—Å–∫–æ–ø ({HOROSCOPE_PRICE}‚≠ê)",
            callback_data=f"pay_horoscope_{sign}"
        )],
        [InlineKeyboardButton("‚óÄÔ∏è –ù–∞–∑–∞–¥", callback_data="menu_main")]
    ]

    await query.edit_message_text(
        f"üîÆ **–ì–æ—Ä–æ—Å–∫–æ–ø –¥–ª—è {sign} {sign_name}**\n\n"
        f"{horoscope}\n\n"
        f"‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n"
        f"–•–æ—á–µ—à—å –ø–æ–¥—Ä–æ–±–Ω—ã–π –ø—Ä–æ–≥–Ω–æ–∑ —Å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å—é?",
        reply_markup=InlineKeyboardMarkup(keyboard),
        parse_mode="Markdown"
    )


async def pay_horoscope(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Create invoice for detailed horoscope"""
    query = update.callback_query
    await query.answer()

    sign = query.data.replace("pay_horoscope_", "")
    user = query.from_user

    context.user_data['horoscope_sign'] = sign

    prices = [LabeledPrice(label="–ü–æ–¥—Ä–æ–±–Ω—ã–π –≥–æ—Ä–æ—Å–∫–æ–ø", amount=HOROSCOPE_PRICE)]

    await context.bot.send_invoice(
        chat_id=user.id,
        title="–ü–æ–¥—Ä–æ–±–Ω—ã–π –ª—é–±–æ–≤–Ω—ã–π –≥–æ—Ä–æ—Å–∫–æ–ø üîÆ",
        description=f"–î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥–Ω–æ–∑ + —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –¥–ª—è {ZODIAC_SIGNS.get(sign, '')}",
        payload=f"horoscope_{user.id}",
        currency="XTR",
        prices=prices,
    )


async def show_detailed_horoscope(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Show detailed horoscope after payment"""
    sign = context.user_data.get('horoscope_sign', '‚ôà')
    detailed = DETAILED_HOROSCOPE.get(sign, "–ó–≤—ë–∑–¥—ã –≥–æ—Ç–æ–≤—è—Ç –¥–ª—è —Ç–µ–±—è —á—Ç–æ-—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ–µ! ‚ú®")

    keyboard = [[InlineKeyboardButton("‚óÄÔ∏è –ú–µ–Ω—é", callback_data="menu_main")]]

    await update.message.reply_text(
        detailed,
        reply_markup=InlineKeyboardMarkup(keyboard),
        parse_mode="Markdown"
    )


def get_horoscope_handlers():
    """Return horoscope handlers"""
    return [
        CallbackQueryHandler(choose_zodiac, pattern="^menu_horoscope$"),
        CallbackQueryHandler(set_zodiac_and_show, pattern="^zodiac_"),
        CallbackQueryHandler(pay_horoscope, pattern="^pay_horoscope_"),
    ]
